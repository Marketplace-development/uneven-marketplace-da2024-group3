<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spinnback - Buy a Record</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #fbe4d5;
        }
    
        .header, .filters-container, .listings-container {
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
    
        .header {
            background-color: #8b5d47;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
        }
    
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
    
        .header button {
            background: white;
            color: #8b5d47;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
    
        .header button:hover {
            background: #d3d3d3;
        }
    
        .main-container {
            display: flex;
            gap: 20px;
            padding: 20px;
        }
    
        .filters-container {
            flex: 1;
            max-width: 300px;
            background-color: #f8f8f8;
            padding: 15px;
        }
    
        .filters-container h3, .filters-container h4 {
            margin: 10px 0;
        }
    
        .filters-container ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
    
        .filters-container li {
            margin-bottom: 8px;
        }
    
        .listings-container {
            flex: 3;
            background-color: #fff;
            padding: 20px;
        }
   
    
        /* Nieuwe CSS voor de grid van #listings-container */
        #listings-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 gelijke kolommen */
            gap: 20px; /* Ruimte tussen items */
        }
    
        #listings-container .listing {
            background-color: #fde9e1;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            text-align: center; /* Optioneel: nette uitlijning */
        }

        .artist {
            font-weight: bold; /* Vetgedrukt maken */
            font-size: 18px;   /* Groter dan gewone tekst */
            margin: 5px 0;     /* Ruimte toevoegen rond de tekst */
            color: #333;       /* Donkere kleur voor contrast */
        }
        
    
        .listing {
            position: relative;
            padding: 15px;
            margin-bottom: 10px;
            background-color: #fde9e1;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
    
        .controls input {
            padding: 10px;
            border: 1px solid #8b5d47;
            border-radius: 5px;
            color: #8b5d47;
            width: 100%;
        }
    
        .buy-button {
            background-color: #8c564b;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
        }
    
        .buy-button:hover {
            background-color: #5e3d2f;
        }

        .price-slider-container {
            margin-bottom: 15px;
        }

        .price-slider {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 5px;
            background: #8b5d47;
            outline: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .price-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 10px;
            height: 10px;
            background: #8b5d47;
            border-radius: 50%;
            cursor: pointer;
        }

        .price-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #8b5d47;
            border-radius: 50%;
            cursor: pointer;
        }

        .price-slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        .range-slider {
            position: relative;
            width: 100%;
            height: 5px;
            background: #8b5d47;  
            border-radius: 5px;
        }

        .range-slider input[type="range"] {
            position: absolute;
            pointer-events: none;
            width: 100%;
            height: 5px;
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            z-index: 3;
        }

        .range-slider input[type="range"]::-webkit-slider-thumb {
            pointer-events: all;
            width: 8px;  
            height: 8px; 
            border-radius: 50%;
            background: #8b5d47; 
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
            position: relative;
            top: 50%; 
            margin-top: -4px; 
        }

        .range-slider input[type="range"]::-moz-range-thumb {
            pointer-events: all;
            width: 8px;  
            height: 8px; 
            border-radius: 50%;
            background: #8b5d47; 
            cursor: pointer;
            position: relative;
            top: 50%; 
            margin-top: -4px; 
        }


        .range-slider .slider-track {
            position: absolute;
            height: 5px;
            top: 0;
            left: 0;
            right: 0;
            background: transparent;
            z-index: 1;
        }

        .range-slider .slider-track::before {
            content: '';
            position: absolute;
            height: 5px;
            top: 0;
            background: #8b5d47; 
            z-index: 2;
            border-radius: 5px;
        }

        .divider {
            border: none; /* Verwijder standaard rand */
            height: 5px; /* Dikte van de lijn */
            background-color: #8b5d47; /* Bruine kleur die consistent is met de header */
            margin: 20px 0; /* Ruimte boven en onder de lijn */
        }
        
        #recommendations {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Drie gelijke kolommen */
            gap: 20px; /* Ruimte tussen de items */
            padding: 10px; /* Ruimte rondom de grid */
        }
        
        #recommendations .recommendation {
            background-color: #fde9e1; /* Achtergrondkleur voor elke aanbeveling */
            border: 1px solid #ddd; /* Lichte rand */
            border-radius: 5px; /* Afgeronde hoeken */
            padding: 15px;
            text-align: center; /* Uitlijning van de inhoud */
            display: flex;
            flex-direction: column; /* Zorg dat inhoud netjes gestapeld is */
            align-items: center; /* Centreer de inhoud horizontaal */
        }
        
        #recommendations .recommendation img {
            max-width: 100%; /* Zorg dat afbeeldingen responsief zijn */
            height: auto; /* Houd de verhouding van afbeeldingen */
            margin-bottom: 10px; /* Ruimte onder de afbeelding */
            border-radius: 5px; /* Afgeronde hoeken */
        }
        

        #recommendations .favorite-button {
            position: absolute;
            top: 10px;    /* Afstand vanaf de bovenkant */
            right: 10px;  /* Afstand vanaf de rechterkant */
            background: none;
            border: none;
            color: gray;  /* Grijs voor niet-actieve hartjes */
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s; /* Zachte overgang van kleur */
        }

        #recommendations .favorite-button.active {
            color: red; /* Rood voor actieve hartjes */
        }



        .recommendation {
            position: relative; /* Zorgt ervoor dat de favorietenknop binnen het kader kan worden gepositioneerd */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: #fde9e1;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
        }

        .recommendation-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        
        .recommendation-details {
            text-align: left;
            flex: 1;
        }
        
        .recommendation-details p {
            margin: 5px 0; /* Ruimte tussen regels */
            font-size: 16px; /* Standaard tekstgrootte */
        }
        
        .recommendation-image {
            max-width: 150px;
            height: auto;
            border-radius: 5px;
        }
        
        
        .recommendation img {
            max-width: 120px;
            max-height: 120px;
            border-radius: 5px;
            object-fit: cover; /* Zorgt dat de afbeelding goed past */
            margin-left: 10px;
        }
        

        
        .recommendation-details .albumname {
            font-weight: bold; /* Maak albumnaam vetgedrukt */
            font-size: 18px; /* Iets grotere tekstgrootte voor de albumnaam */
        }
        
        .recommendation-details .artist {
            font-weight: bold; /* Maak de artiest vetgedrukt */
            font-size: 16px; /* Iets kleiner dan albumnaam */
        }
        
        .recommendation-details .genre, .recommendation-details .condition {
            font-size: 14px; /* Iets kleinere tekstgrootte voor overige attributen */
            color: #555; /* Lichtere kleur voor visuele hiërarchie */
        }
        
        .favorite-button {
            background: none;
            border: none;
            color: gray; /* Grijs wanneer niet actief */
            font-size: 24px; /* Grootte van het hartje */
            cursor: pointer;
            transition: color 0.3s; /* Zachte overgang */
            margin-left: 10px; /* Ruimte naast de buy-knop */
        }   

        .favorite-button.active {
            color: red; /* Rood wanneer actief */
        }   

        .favorite-button:focus {
            outline: none; /* Verwijder focusrand */
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Spinnback</h1>
        <button onclick="goToDashboard()">Go To Dashboard</button>
    </div>

    <div class="main-container">
        <div class="filters-container">
            <h3>Filters</h3>
            <div class="price-slider-container">
                <h4>Price:</h4>
                <div class="range-slider">
                    <input id="price-min-slider" type="range" min="0" max="200" value="0" step="1" oninput="updateRangeSlider()" />
                    <input id="price-max-slider" type="range" min="0" max="200" value="200" step="1" oninput="updateRangeSlider()" />
                    <div class="slider-track"></div>
                </div>
                <div class="price-slider-labels">
                    <span id="price-min">€0</span>
                    <span id="price-max">€200</span>
                </div>
            </div>                
            <div id="genre-filters">
                <h4>Genre:</h4>
                <ul id="genre-filters">
                    <li><input type="checkbox" value="Pop" onchange="applyFilters()"> Pop</li>
                    <li><input type="checkbox" value="Rock" onchange="applyFilters()"> Rock</li>
                    <li><input type="checkbox" value="Jazz" onchange="applyFilters()"> Jazz</li>
                    <li><input type="checkbox" value="Blues" onchange="applyFilters()"> Blues</li>
                    <li><input type="checkbox" value="Hip-hop/Rap" onchange="applyFilters()"> Hip-hop/Rap</li>
                    <li><input type="checkbox" value="Classical" onchange="applyFilters()"> Classical</li>
                    <li><input type="checkbox" value="Electronic/Dance" onchange="applyFilters()"> Electronic/Dance</li>
                    <li><input type="checkbox" value="Reggae" onchange="applyFilters()"> Reggae</li>
                    <li><input type="checkbox" value="R&B/Soul" onchange="applyFilters()"> R&B/Soul</li>
                    <li><input type="checkbox" value="Country" onchange="applyFilters()"> Country</li>
                    <li><input type="checkbox" value="Folk" onchange="applyFilters()"> Folk</li>
                    <li><input type="checkbox" value="Metal" onchange="applyFilters()"> Metal</li>
                    <li><input type="checkbox" value="Latin" onchange="applyFilters()"> Latin</li>
                    <li><input type="checkbox" value="Indie/Alternative" onchange="applyFilters()"> Indie/Alternative</li>
                    <li><input type="checkbox" value="World Music" onchange="applyFilters()"> World Music</li>
                </ul>

            </div>
            <div id="size-filters">
                <h4>Size:</h4>
                <ul>
                    <li><input type="checkbox" value='12"' onchange="applyFilters()"> 12"</li>
                    <li><input type="checkbox" value='10"' onchange="applyFilters()"> 10"</li>
                    <li><input type="checkbox" value='7"' onchange="applyFilters()"> 7"</li>
                </ul>
            </div>
            <div id="condition-filters">
                <h4>State:</h4>
                <ul>
                    <li><input type="checkbox" value="M" onchange="applyFilters()"> M (Mint)</li>
                    <li><input type="checkbox" value="NM" onchange="applyFilters()"> NM (Near Mint)</li>
                    <li><input type="checkbox" value="VG+" onchange="applyFilters()"> VG+ (Very Good Plus)</li>
                    <li><input type="checkbox" value="VG" onchange="applyFilters()"> VG (Very Good)</li>
                    <li><input type="checkbox" value="G" onchange="applyFilters()"> G (Good)</li>
                    <li><input type="checkbox" value="P" onchange="applyFilters()"> P (Poor)</li>
                </ul>
            </div>
            <div id="rating-filters">
                <h4>Seller Rating:</h4>
                <ul>
                    <li><input type="radio" name="rating" value="1" onchange="applyFilters()"> 1+</li>
                    <li><input type="radio" name="rating" value="2" onchange="applyFilters()"> 2+</li>
                    <li><input type="radio" name="rating" value="3" onchange="applyFilters()"> 3+</li>
                    <li><input type="radio" name="rating" value="4" onchange="applyFilters()"> 4+</li>
                    <li><input type="radio" name="rating" value="" onchange="applyFilters()" checked> All</li>
                </ul>
            </div>            
        </div>


        <div class="listings-container">
            <h1>Buy a record</h1>
            <div class="controls">
                <input type="text" id="search" placeholder="Search album or artist" onkeyup="searchListings()" />
                <select id="sort" class="sort-dropdown" onchange="sortListings(this.value)">
                    <option value="asc">Price: Low to High</option>
                    <option value="desc">Price: High to Low</option>
                </select>
            </div>
            <div id="recommendations-container">
                <h2>Recommended for You</h2>
                <div id="recommendations">
                    <p>Loading recommendations...</p>
                </div>
            </div>            
            <hr class="divider">
            <div id="listings-container">
                <div id="listings-container">
                    <p>Loading listings...</p>
                </div>
            </div>
            
        </div>
    </div>
    <script>
        let allListings = [];
        let baseListings = []; // Resultaten na zoekopdracht
        let filteredListings = []; // Resultaten na filters
        let allRecommendations = [];
        let filteredRecommendations = [];
        let maxPrice = 0;
        let favoriteIds = new Set();

        function applyFilters() {
            const genres = getSelectedValues("genre-filters");
            const sizes = getSelectedValues("size-filters");
            const conditions = getSelectedValues("condition-filters");
            const minPrice = parseFloat(document.getElementById('price-min-slider').value);
            const maxPrice = parseFloat(document.getElementById('price-max-slider').value);
    
    // Haal de geselecteerde verkopersbeoordeling op
            const selectedRating = document.querySelector('input[name="rating"]:checked').value;
            const minRating = selectedRating ? parseFloat(selectedRating) : 0;

    // Start met de zoekresultaten
            filteredListings = baseListings.filter(listing =>
                (genres.length === 0 || genres.includes(listing.genre)) &&
                (sizes.length === 0 || sizes.includes(listing.size)) &&
                (conditions.length === 0 || conditions.includes(listing.condition)) &&
                listing.price >= minPrice && listing.price <= maxPrice &&
                listing.seller_rating >= minRating // Filter op verkopersbeoordeling
            );

            renderListings(filteredListings);
        }


        function renderListings(listings) {
            const container = document.getElementById('listings-container');
            container.innerHTML = listings.length
                ? listings.map(listing => `
                    <div class="listing">
                        <img src="${listing.image}" alt="${listing.albumname} cover" style="width:100px; height:auto; border-radius:5px; margin-bottom:10px;">
                        <h2>${listing.albumname}</h2>
                        <p class="artist">${listing.artist}</p>
                        <p>${listing.genre}</p>
                        <p>Condition: ${listing.condition}</p>
                        <button class="buy-button" onclick="buyRecord('${listing.recordid}')">Buy Now - €${listing.price}</button>
                        <button class="favorite-button ${listing.isFavorite ? 'active' : ''}" 
                                onclick="toggleFavorite('${listing.recordid}', this)">
                            ❤
                        </button>
                    </div>
                `).join('')
                : '<p>No results found.</p>';
        }

        function searchListings() {
            const query = document.getElementById('search').value.toLowerCase();

    // Filter op zoekopdracht
            baseListings = allListings.filter(listing =>
                listing.albumname.toLowerCase().includes(query) ||
                listing.artist.toLowerCase().includes(query)
            );

    // Pas filters toe op de zoekresultaten
            applyFilters();
        }



        function sortListings(order) {
            filteredListings.sort((a, b) => order === 'asc' ? a.price - b.price : b.price - a.price);
            renderListings(filteredListings);
        }

        async function loadListings() {
            const response = await fetch('/get_records_sellyes');
            allListings = await response.json();

            const prices = allListings.map(listing => listing.price);
            const [minPrice, maxPrice] = [Math.min(...prices), Math.max(...prices)];

    // Update sliders
            Object.assign(document.getElementById('price-min-slider'), { max: maxPrice, value: minPrice });
            Object.assign(document.getElementById('price-max-slider'), { max: maxPrice, value: maxPrice });

    // Update labels
            document.getElementById('price-min').innerText = `€${minPrice}`;
            document.getElementById('price-max').innerText = `€${maxPrice}`;

    // Initialize listings
            baseListings = [...allListings]; // Zoekresultaten starten als volledige lijst
            filteredListings = [...allListings]; // Filters werken op basis van de volledige lijst
            renderListings(filteredListings);
        }


        function updateRangeSlider() {
            const minSlider = document.getElementById('price-min-slider');
            const maxSlider = document.getElementById('price-max-slider');
            const minValue = parseFloat(minSlider.value);
            const maxValue = parseFloat(maxSlider.value);
            const sliderTrack = document.querySelector('.slider-track');

    
            if (minValue > maxValue - 1) {
                minSlider.value = maxValue - 1;
            }
            if (maxValue < minValue + 1) {
                maxSlider.value = minValue + 1;
            }

            document.getElementById('price-min').innerText = `€${minSlider.value}`;
            document.getElementById('price-max').innerText = `€${maxSlider.value}`;

            const minPercent = (minValue / maxSlider.max) * 100;
            const maxPercent = (maxValue / maxSlider.max) * 100;

            sliderTrack.style.background = `linear-gradient(to right, #8b5d47 ${minPercent}%, #8b5d47 ${maxPercent}%, #ddd ${maxPercent}%)`;
            
            applyFilters();
        }
      
        async function updateFavoriteStatus(recordId, isFavorite) {
            const response = await fetch('/update_favorite_status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ recordid: recordId, isFavorite })
            });

            if (!response.ok) {
                console.error('Failed to update favorite status.');
            }
        }
      
        function toggleFavorite(recordId, buttonElement) {
            const isFavorite = !buttonElement.classList.contains('active');
            buttonElement.classList.toggle('active'); // Toggle de 'active' klasse voor rood hartje

    // De tekst verandert niet meer, de kleur verandert enkel door de active klasse
            buttonElement.textContent = '❤';  // Zorg ervoor dat het hartje altijd weergegeven wordt

    // Update de status in de backend
            updateFavoriteStatus(recordId, isFavorite);

            if (isFavorite) {
                favoriteIds.add(recordId); // Voeg toe aan favoriete lijst
            } else {
                favoriteIds.delete(recordId); // Verwijder uit favoriete lijst
            }
        }





        function getSelectedValues(containerId) {
            return Array.from(document.querySelectorAll(`#${containerId} input:checked`))
                .map(input => input.value.trim()); 
        }

        function buyRecord(recordid) {
            window.location.href = `/koop_1plaat/${recordid}`;
        }
        async function loadRecommendations() {
            const response = await fetch('/get_recommendations');
            const recommendationsContainer = document.getElementById('recommendations');

            if (response.ok) {
                allRecommendations = await response.json();

        // Voeg de favorietenstatus toe aan de aanbevelingen
                filteredRecommendations = allRecommendations.map(rec => ({
                    ...rec,
                    isFavorite: favoriteIds.has(rec.recordid)  // Zet de isFavorite status
                }));

                renderRecommendations(filteredRecommendations);  // Render de updated recommendations
            } else {
                recommendationsContainer.innerHTML = '<p>Failed to load recommendations.</p>';
            }
        }

        
        function renderRecommendations(recommendations) {
            const recommendationsContainer = document.getElementById('recommendations');
            recommendationsContainer.innerHTML = recommendations.length
                ? recommendations.map(rec => `
                    <div class="recommendation">
                        <button class="favorite-button ${favoriteIds.has(rec.recordid) ? 'active' : ''}" 
                                onclick="toggleFavorite('${rec.recordid}', this)">
                            ❤
                        </button>
                        <div class="recommendation-content">
                            <div class="recommendation-details">
                                <p class="albumname">${rec.albumname}</p>
                                <p class="artist">${rec.artist}</p>
                                <p class="genre">${rec.genre}</p>
                                <p class="condition">Condition: ${rec.condition}</p>
                            </div>
                            <img src="${rec.image}" alt="${rec.albumname} cover" class="recommendation-image">
                        </div>
                        <button class="buy-button" onclick="buyRecord('${rec.recordid}')">Buy Now - €${rec.price}</button>
                    </div>
                `).join('')
                : '<p>No recommendations available.</p>';
        }



        async function loadFavorites() {
            const response = await fetch('/get_favorites');
            if (response.ok) {
                const data = await response.json();
                favoriteIds = new Set(data); // Opslaan van favoriete record-ID's
            } else {
                console.error('Failed to load favorites');
            }
        }

        async function renderPage() {
            await loadFavorites(); // Laad favorieten eerst
            renderListings(allListings.map(listing => ({
                ...listing,
                isFavorite: favoriteIds.has(listing.recordid)
            })));
            renderRecommendations(allRecommendations.map(rec => ({
                ...rec,
                isFavorite: favoriteIds.has(rec.recordid)
            })));
        }

        window.onload = async function() {
            await loadListings();         // Haal de listings op
            await loadRecommendations();  // Haal de recommendations op
            await renderPage();           // Render listings en recommendations
        };

        // Laad aanbevelingen bij het laden van de pagina
        loadRecommendations();
        // (Other functions like applyFilters, searchListings, sortListings remain the same)
        function goToDashboard() {
            window.location.href = '/dashboard';
        }

        loadListings();
    </script>
</body>
</html>

